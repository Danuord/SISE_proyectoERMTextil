<!doctype html>
<html lang="es">
    
<head>
  <meta charset="UTF-8">

  <title>Registro de pagos | TextileFlow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="../../css/common/sidebar-new.css">
  <link rel="stylesheet" href="../../css/dashboard.css">
  <link rel="stylesheet" href="../../css/modules/ventas.css">
  <script src="../../js/sessionProtection.js"></script>
  <script>
        window.toggleMenu = function () {
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                sidebar.classList.toggle('active');
            }
        };
    </script>
</head>

<body>
  <div class="layout">
    <div id="sidebar-container"></div>
  
    <main class="main-content">

      <div class="header">
        <button class="toggle-menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        <div>
          <h1>Control de ventas</h1>
          <p>Gestión y registro de ventas</p>
        </div>
      </div>
  
      <section class="card">
          
          <div class="control-head">
            <h3>Registro de ventas</h3>
          </div>

        <div class="panel-buttons">

          <div class="column-selector-container">
            <button id="columnSelectorBtn" class="btn-filtcolumn">
              <i class="fas fa-columns"></i> Columnas
            </button>

            <div id="columnSelectorMenu" class="column-selector-menu hidden">
                <label><input type="checkbox" data-col="0" checked> Código</label>
                <label><input type="checkbox" data-col="1" checked> Producto</label>
                <label><input type="checkbox" data-col="2" checked> Fecha</label>
                <label><input type="checkbox" data-col="3" checked> Cantidad</label>
                <label><input type="checkbox" data-col="4" checked> Precio total</label>
            </div>
          </div>

          <div class="export-buttons">
            <button id="exportVentasBtn" class="btn-export excel"><i class="fa-solid fa-file-excel"></i> Exportar registros</button>
            <button id="btnOpen" class="btn-regventas">Registrar venta</button>
          </div>
          
        </div>
  
        <div style="margin-top:20px; overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

          <table id="salesTable">
            <thead>
              <tr>
                <th class="sortable">Nro Comprobante</th>
                <th class="sortable">Cliente</th>
                <th class="sortable">Fecha</th>
                <th class="sortable">Cantidad de articulos</th>
                <th class="sortable">Monto total</th>
                <th class="no-export">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-body"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>
 
<!-- MODAL REGISTRO -->
<div id="modalBack" class="modal-back">
  <div class="modal" role="dialog" aria-modal="true">
      <h3 id="modalTitle">Registrar venta</h3>
 
      <div>
        <div>
          <div class="first-row">
            <div>
                <label>Categoria:</label>
                <select id="selectCategorias"></select>
            </div>
            <div>
                <label>Producto:</label>
                <select id="categorySel"></select>
            </div>
            <div>
                <label>Cliente:</label>
                <select id="clienteSel"></select>
            </div>
        </div>

          <div class="form-row">
            <label>Cantidad:</label>
            <input id="quantity" type="number" min="1" value="1" />
          </div>
 
          <div class="form-row">
            <label>Monto base:</label>
            <div class="monto" id="montounit"></div>
            <label>Monto total:</label>
            <div class="monto" id="montototal"></div>   
          </div>
        </div>
 
        <div class="actions-row">
          <button id="btnAddItem" class="btn-primary">Agregar</button>
          <button id="btnClear" class="btn-secondary">Limpiar</button>
          <button id="btnSaveSale" class="btn-primary">Guardar</button>
          <button id="btnCloseModal" class="btn-secondary">Cerrar</button>
        </div>
 
        <div class="items-wrap" style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Código</th>
                <th>Producto</th>
                <th>Fecha</th>
                <th>Cantidad</th>
                <th>Precio unitario</th>
                <th>Precio total</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
          </table>
        </div>
      </div>
  </div>
</div>
 
<div id="viewBack" class="modal-back">
  <div class="modal">
    <h3>Detalle de venta</h3>
    <div id="viewContent"></div>
 
    <div style="text-align:right;margin-top:12px; display:flex; justify-content: flex-end; gap:10px;">
      <button id="printView" class="icon-btn" style="background:#5B3CC4;color:#fff;padding:8px 14px;border-radius:8px;display:flex;align-items:center;gap:8px;">
        <i class="fa-solid fa-print"></i> Imprimir
      </button>
 
      <button id="closeView" class="icon-btn" style="background:#e5e7eb;padding:8px 14px;border-radius:8px;">
        Cerrar
      </button>
    </div>
 
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module" src="../../components/sidebar.js"></script>
 
<script type="module" src="../../js/ventas.js"></script>

<div id="pdfViewerModal" class="pdf-modal hidden">
        <div class="pdf-container">
            <iframe id="pdfViewerFrame"></iframe>

            <div class="pdf-footer">
                <button id="closePdfModal" class="btn-cancelar">Cerrar</button>
            </div>
        </div>
    </div>
 
</body>
</html>

